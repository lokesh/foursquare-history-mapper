<!doctype html>
<html class="no-js" lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

  <title></title>

  <meta name="viewport" content="width=device-width,initial-scale=1">

  <style>
    body {
      padding: 0;
      margin: 0;
      font: 400 normal 16px/1.5 "Berkeley Mono", Roboto, Helvetica, Arial, sans-serif;
    }

    .vue-dat-gui {
      width: 320px !important;
    }  

    .debug {
      position: fixed;
      top: 0;
      left: 0;
      width: 320px;
      padding: 4px;
      font-size:  10px;
      color: #fff;
      background: #222;
    }
  </style>

</head>
<body>

<div id="app">

  <div class="debug">
    Count: {{ places.length }}<br />
    Bounding Box: {{ r(boxTopLeft.lat) }}, {{ r(boxTopLeft.lng) }} TO {{ r(boxBottomRight.lat) }}, {{ r(boxBottomRight.lng) }}
  </div>

  <dat-gui>
    <dat-number v-model="minVisitCount" label="Min visit count"></dat-number>
    <dat-number v-model="cols" label="Rows/Cols"></dat-number>
    <dat-folder label="Geo">
      <dat-select v-model="area" :items="areaSelectOptions"  label="Areas" @change="onAreaChange" /></dat-folder>
      <!-- <dat-number v-model="boxTopLeft" label="Top left bound"></dat-number>
      <dat-number v-model="boxBottomRight" label="Bottom right bound"></dat-number> -->
    </dat-folder>
    <dat-folder label="Style">
      <dat-color v-model="colorBg" label="Background"></dat-color>
      <dat-color v-model="colorLabel" label="Label color"></dat-color>
    </dat-folder>
    <!-- <dat-string v-model="title" label="Title"/>
    <dat-button @click="triggerAlert" label="Trigger alert"/>
    <dat-folder label="Picture">
      <dat-select v-model="pictureUrl" :items="pictures" label="Picture"/>
      <dat-boolean v-model="showPicture" label="Show Picture"/>
      <dat-button @click="nextPicture" label="Next picture"/>
      <dat-folder label="Box shadow">
        <dat-number v-model="boxShadow.offsetX" :min="-100" :max="100" :step="1" label="Offset X"/>
        <dat-number v-model="boxShadow.offsetY" :min="-100" :max="100" :step="1" label="Offset Y"/>
        <dat-number v-model="boxShadow.blurRadius" :min="0" :max="100" :step="1" label="Blur radius"/>
        <dat-number v-model="boxShadow.spreadRadius" :min="0" :max="30" :step="1" label="Spread radius"/>
        <dat-color v-model="boxShadow.color" label="Color"/>
      </dat-folder>
    </dat-folder>-->
  </dat-gui>


</div>

<script src="https://unpkg.com/vue@2.6.10/dist/vue.js"></script>
<script src="https://unpkg.com/@cyrilf/vue-dat-gui@latest/dist/vue-dat-gui.umd.min.js"></script>


<script type="module">
import {
  filterPlacesByBoundingBox,
  getBoundingBox,
} from './utils/geo.js';

const round = (num) => Number(num).toFixed(2);

const AREA_OPTIONS = {
  'San Francisco': {    
    city: 'San Francisco',
    state: 'CA',
    country: 'United States',
  },
  'California': {
    state: 'CA',
    country: 'United States',
  },        
  'United States': {
    country: 'United States',
  }
};

const areaSelectOptions = Object.keys(AREA_OPTIONS).map(opt => {
  return {
    name: opt,
    value: opt,
  }
})

// -122.524027,37.711959,-122.373359,37.81578

// value: {
//   state: 'California',
//   country: 'United States',
// },
// -124.48,32.53,-114.13,42.01


var app = new Vue({
  el: '#app',

  data() {
    return {
      places: [],
      placesUnfiltered: [],

      boxTopLeft: { lat: 0, lng: 0 },
      boxBottomRight: { lat: 0, lng: 0 },

      cols: 24,
      minVisitCount: 24,
      colorBg: '#fff',
      colorLabel: '#000',
      areaSelectOptions,
      area: '',

      // Helper funcs
      r: round,
    };
  },

  async created() {
    const resp = await fetch('./data/places.json');
    const json = await resp.json();
    this.places = this.placesUnfiltered = json;
  },

  watch: {
    places(val, oldVal) {
      const box = getBoundingBox(val);
      this.boxTopLeft = box[0];
      this.boxBottomRight = box[1];
    },
  },

  methods: {
    onAreaChange(val) {
      const opt = AREA_OPTIONS[val];

      this.places = this.placesUnfiltered.filter(place => {
        if (opt.city && place.city !== opt.city) return false;
        if (opt.state && place.state !== opt.state) return false;
        if (opt.country && place.country !== opt.country) return false;
        return true;
      });
    }
  }
});
</script>


  

</body>
</html>
